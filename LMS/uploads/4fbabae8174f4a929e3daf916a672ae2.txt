# Member객체를 CRUD 기능을 넣는다.
# 메뉴 구현
# 텍스트파일 처리 (파일 읽기, 파일 저장)
# 회원가입, 로그인, 로그아웃, 회원수정, 회원탈퇴
import os

from Member import Member # 회원 객체 추가연결
# 사용법 member = Member() -> 객체가 생성됨
#       member.필드/메서드 = ????

class MemberService:
    def __init__(self, file_name="members.txt"):
    # 클래스가 생성할때 초기값 관리
        self.file_name = file_name
        self.members = []  # 회원들을 리스트로 만들어 Member()객체를 담는다.
        self.session = None # 로그인상태를 담당(members의 인덱스 보관용)
        self.load_members() # 아래쪽에 메서드 호출

    def run(self):
        run = True
        while run:
            self.main_menu()
            sel = input(">>> ")

            if sel == "1": self.member_add()
            elif sel == "2": self.member_login()
            elif sel == "3": self.member_logout()
            elif sel == "4": self.member_modify()
            elif sel == "5": self.member_delete()
            elif sel == "9": run = False
            else :
                print("잘못 입력하셨습니다.")

    def load_members(self): # 파일에서 메모리로 불러온다.
        if not os.path.exists(self.file_name): # 맨위에 import os
            self.save_members()
            return

        with open(self.file_name, "r", encoding="utf-8") as f:
            for line in f:
                self.members.append(Member.from_line(line))
                #                   Member객체에 .from_line() 메서드 실행
                #                               1줄을 가져와 클래스로 만듬
                #    members리스트 뒷부분에 추가

    def main_menu(self):
        print("""
==== 회원관리 프로그램 (Member 객체 기반) ====
1. 회원가입
2. 로그인
3. 로그아웃
4. 회원정보수정
5. 회원탈퇴
9. 종료
        """)

    def member_add(self):
        print("\n[회원가입]")
        uid = input("아이디 : ")

        if self.find_member(uid): # 자주쓰는 중복코드로 메서드 처리함!!!
            print("이미 존재하는 아이디")
            return

        pw = input("비밀번호 : ")
        name = input("이름 : ")
        role = "user"

        self.members.append(Member(uid, pw, name, role))
        #                   Member클래스의 init메서드로 바로 들어가 객체 생성
        self.save_members()
        self.load_members()
        print("회원가입 완료")

    def member_login(self):
        pass

    def member_logout(self):
        pass

    def member_modify(self):
        pass

    def member_delete(self):
        pass

    # 파일 저장용 코드
    def save_members(self):
        with open(self.file_name, "w", encoding="utf-8") as f:
            for member in self.members:
                f.write(member.to_line())
                #       Member객체의 메서드를 사용하여 1줄씩 기록

    # id를 이용해 members에서 찾는 공통 메서드
    def find_member(self, uid):
        for member in self.members:
        # members 리스트에서 1개씩 member객체를 가져와
            if member.id == uid: # 가져온 member객체.id와 전달받은 id가 같은지
                print(member.name ,"님을 찾았습니다.")
                # 예전에는 member[2]으로 찾는데 지금은 변수명으로 찾을 수 있음

                return member # 같은게 있으면 member객체를 리턴
        return None # None으로 리턴